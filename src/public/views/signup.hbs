{{>header}}
<main class="flex flex-center">
  <div class="card">
    <div class="">
      <h1 class="card__title">Create Account</h1>
    </div>
    <div class="">
      <p class="error hidden">Error: <span class="error-msg"></span></p>
      <form action="" method="POST" class="auth-form">
        <div class="form__row">
          <label for="email" class="block pb-1.5">Mail :</label>
          <input type="email" name="email" id="email" minlength="8"
            class=""
            placeholder="Enter your email" required>
        </div>
        <div class="form__row">
          <label for="pwd" class="block pb-1.5">Password :</label>
          <input type="password" name="password" id="pwd" minlength="8"
            class=""
            placeholder="Enter your password" required>
          
        </div>
        <div class="form__row">
          <label for="pwd" class="block pb-1.5">Password :</label>
          <input type="password" name="password" id="verif-pwd" minlength="8"
            class=""
            placeholder="Enter your password agin" required>
        </div>
        <button type="submit" id="login-btn"
          class="black w-full">Create
          Account</button>
      </form>
    </div>
  </div>
</main>

<script>
  const form = document.querySelector('form');
  const email = document.querySelector('#email');
  const firstPassword = document.querySelector('#pwd');
  const verifiedPassword = document.querySelector('#verif-pwd');
  const error = document.querySelector('.error');
  const errorMsg = document.querySelector('.error-msg');

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const mail = email.value;
    const password = firstPassword.value;
    if (!(password === verifiedPassword.value)) {
      errorMsg.textContent = 'passwords dont match';
      error.style.display = 'block';
    } else {
      const params = {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email: mail, password })
      }

      fetch('http://localhost:3000/users/signup', params)
      .then(res => res.json())
      .then((res) => {
        if(res.error){
          error.style.display = "block";
          errorMsg.textContent = 'User already exist';
        }else{
          window.location.href = 'http://localhost:3000/dashboard';
        }
      })
    }
  })
</script>